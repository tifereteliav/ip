<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>המצפן לבחירת משאבה</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Google Fonts (Optional for better Hebrew typography) -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;700;900&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Heebo', sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen text-gray-800">

    <!-- App Container -->
    <div id="app" class="container mx-auto px-4 py-8 min-h-screen flex flex-col items-center justify-center">
        
        <!-- Screen 1: Welcome -->
        <div id="welcome-screen" class="bg-white max-w-lg w-full rounded-2xl shadow-xl p-8 text-center fade-in">
            <div class="bg-blue-100 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6">
                <i data-lucide="activity" class="w-10 h-10 text-blue-600"></i>
            </div>
            <h1 class="text-3xl font-bold text-gray-800 mb-4">המצפן לבחירת משאבה</h1>
            <p class="text-gray-600 mb-8 text-lg">
                כלי עזר לקבלת החלטות למטופלי סוכרת סוג 1.
                <br/>
                ענה על 5 שאלות קצרות וקבל המלצה המותאמת לאורח החיים ולהעדפות הרפואיות שלך.
            </p>
            
            <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 mb-8 text-sm text-yellow-800 text-right">
                <strong>שים לב:</strong> הכלי נועד למטרות הסברה בלבד ואינו מחליף ייעוץ רפואי מקצועי.
            </div>

            <button onclick="startQuiz()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-4 px-6 rounded-xl transition-all transform hover:scale-105 shadow-lg flex items-center justify-center gap-2">
                בוא נתחיל
                <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>
        </div>

        <!-- Screen 2: Question -->
        <div id="question-screen" class="hidden w-full max-w-xl flex-col items-center">
            <!-- Progress Bar -->
            <div class="w-full mb-8">
                <div class="flex justify-between text-sm text-gray-500 mb-2">
                    <span id="progress-text">שאלה 1 מתוך 5</span>
                    <span id="progress-percent">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-500 ease-out" style="width: 0%"></div>
                </div>
            </div>

            <!-- Question Card -->
            <div class="bg-white rounded-2xl shadow-lg p-8 w-full fade-in">
                <h2 id="question-text" class="text-2xl font-bold text-gray-800 mb-8 leading-relaxed">
                    <!-- Question goes here -->
                </h2>

                <div id="options-container" class="space-y-4">
                    <!-- Options go here -->
                </div>
            </div>
        </div>

        <!-- Screen 3: Results -->
        <div id="result-screen" class="hidden max-w-3xl w-full mx-auto fade-in">
            <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">התוצאות שלך</h1>

            <!-- Top Match Card -->
            <div class="bg-white rounded-2xl shadow-xl overflow-hidden mb-8 border-t-4 border-blue-600">
                <div class="bg-blue-50 p-6 flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <span class="text-blue-600 font-bold uppercase tracking-wider text-sm">ההתאמה המובילה</span>
                        <h2 id="result-name" class="text-3xl font-extrabold text-gray-900 mt-1"></h2>
                        <p id="result-tagline" class="text-blue-800 mt-1 font-medium"></p>
                    </div>
                    <div class="bg-white p-3 rounded-full shadow-sm">
                        <i data-lucide="check-circle" class="w-8 h-8 text-green-500"></i>
                    </div>
                </div>
                
                <div class="p-8">
                    <p id="result-description" class="text-lg text-gray-700 mb-6 leading-relaxed"></p>
                    
                    <div class="grid md:grid-cols-2 gap-8">
                        <div>
                            <h3 class="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <i data-lucide="heart" class="w-5 h-5 text-green-600"></i>
                                למה זה מתאים לך?
                            </h3>
                            <ul id="result-pros" class="space-y-2"></ul>
                        </div>

                        <div>
                            <h3 class="font-bold text-gray-900 mb-3 flex items-center gap-2">
                                <i data-lucide="alert-circle" class="w-5 h-5 text-orange-500"></i>
                                נקודות למחשבה
                            </h3>
                            <ul id="result-cons" class="space-y-2"></ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Runner Up -->
            <div class="bg-white rounded-2xl shadow-md p-6 mb-8 opacity-90">
                <div class="flex items-center gap-3 mb-4">
                    <div class="bg-gray-100 p-2 rounded-lg">
                        <i data-lucide="settings" class="w-6 h-6 text-gray-600"></i>
                    </div>
                    <div>
                        <h3 class="text-xl font-bold text-gray-800">אפשרות שנייה: <span id="runner-up-name"></span></h3>
                        <p id="runner-up-tagline" class="text-sm text-gray-500"></p>
                    </div>
                </div>
                <p id="runner-up-desc" class="text-gray-600 text-sm mb-4"></p>
                <div class="text-sm text-blue-600 font-medium">
                    + יתרון מרכזי: <span id="runner-up-pro"></span>
                </div>
            </div>

            <!-- Summary -->
            <div class="bg-gray-100 rounded-xl p-6 mb-8 text-sm">
                <h4 class="font-bold text-gray-700 mb-4">סיכום התשובות שלך:</h4>
                <ul id="history-list" class="space-y-2"></ul>
            </div>

            <div class="flex flex-col gap-4">
                <button onclick="window.print()" class="w-full bg-white border border-gray-300 text-gray-700 font-bold py-3 rounded-xl hover:bg-gray-50 transition-colors">
                    הדפס / שמור כ-PDF
                </button>
                
                <button onclick="resetQuiz()" class="w-full bg-blue-600 text-white font-bold py-3 rounded-xl hover:bg-blue-700 transition-colors">
                    התחל מחדש
                </button>
            </div>
        </div>

    </div>

    <!-- Logic Script -->
    <script>
        // --- DATA ---
        const PUMPS = {
            medtronic: {
                id: 'medtronic',
                name: 'MiniMed 780G',
                tagline: 'המתקנת האוטומטית',
                description: 'מערכת עם תיקון אוטומטי אגרסיבי (כל 5 דקות). מתאימה למי שרוצה שהמשאבה תעבוד קשה בשבילו למניעת גבוהים.',
                pros: [
                    'תיקון אוטומטי מלא (בזאל + בולוס) כל 5 דקות',
                    'מצויינת למניעת היפרגליקמיה (סוכר גבוה)',
                    'עובדת עם סנסור Guardian 4 / Simplera (לא דורש כיולים)'
                ],
                cons: [
                    'מחייבת שימוש בסנסור של מדטרוניק בלבד',
                    'פחות שליטה מהטלפון הנייד (בעיקר צפייה)',
                    'דורשת ספירת פחמימות'
                ]
            },
            tandem: {
                id: 'tandem',
                name: 'Tandem t:slim X2 / Mobi',
                tagline: 'המתאימה אישית',
                description: 'גמישות מלאה ושליטה. אלגוריתם Control-IQ שצופה קדימה ומצב שינה ייעודי.',
                pros: [
                    'מגוון סנסורים (Dexcom, Libre 2+)',
                    'שליטה מלאה מהנייד (בדגם Mobi ואפליקציית t:connect)',
                    'מצב שינה (Sleep Mode) לשמירה הדוקה בלילה',
                    'קטנה מאוד (Mobi)'
                ],
                cons: [
                    'תיקון אוטומטי (בולוס) רק פעם בשעה (אך מגבירה בזאל)',
                    'דורשת ספירת פחמימות'
                ]
            },
            omnipod: {
                id: 'omnipod',
                name: 'Omnipod 5',
                tagline: 'החופשייה מצינורות',
                description: 'משאבת הפד (מדבקה) היחידה עם מערכת אוטומטית היברידית. ללא צינוריות כלל.',
                pros: [
                    'ללא צינורית (Tubeless) - חופש תנועה מלא',
                    'אלגוריתם לומד ומתאים את עצמו בכל החלפת פוד',
                    'תואמת Dexcom G6/G7 ו-Libre 2+',
                    'אפליקציה מלאה לטלפונים תואמים'
                ],
                cons: [
                    'אין בולוסים אוטומטיים לתיקון (רק הגברת בזאל)',
                    'פחות אגרסיבית בתיקון סוכר גבוה מאוד'
                ]
            },
            ilet: {
                id: 'ilet',
                name: 'iLet Bionic Pancreas',
                tagline: 'אוטונומיה מלאה',
                description: 'המערכת שעושה הכל לבד. אין צורך לספור פחמימות או לקבוע הגדרות בסיס.',
                pros: [
                    'אין ספירת פחמימות! (רק "ארוחה רגילה/גדולה/קטנה")',
                    'לא דורשת הגדרת בזאל או רגישות',
                    'לומדת את המטופל באופן מלא'
                ],
                cons: [
                    'אי אפשר לשנות הגדרות ידנית אם רוצים',
                    'יעדי סוכר קבועים (רגיל, נמוך, גבוה)'
                ]
            },
            twiist: {
                id: 'twiist',
                name: 'twiist (Tidepool)',
                tagline: 'גמישות בבחירה',
                description: 'מערכת המבוססת על אפליקציית Tidepool Loop, מאפשרת בחירה רחבה של סנסורים והגדרות.',
                pros: [
                    'תמיכה רחבה בסנסורים (כולל Libre 3, Eversense)',
                    'שליטה מאפל ווטש (Apple Watch)',
                    'אלגוריתם המכוון לערך ספציפי ולא לטווח'
                ],
                cons: [
                    'מחייבת שימוש ב-iPhone (נכון להיום)',
                    'דורשת הבנה טכנולוגית מסוימת'
                ]
            }
        };

        const QUESTIONS = [
            {
                id: 'tubing',
                text: 'מהי ההעדפה שלך לגבי חיבור המשאבה לגוף?',
                options: [
                    {
                        text: 'חשוב לי מאוד להיות בלי צינורית בכלל (משאבת מדבקה)',
                        score: { omnipod: 10, medtronic: -2, tandem: -2, ilet: -2, twiist: -2 }
                    },
                    {
                        text: 'אין לי בעיה עם צינורית, כל עוד המשאבה חכמה',
                        score: { medtronic: 3, tandem: 3, ilet: 3, twiist: 3, omnipod: 0 }
                    },
                    {
                        text: 'מעדיף צינורית קצרה או משאבה זעירה שניתן להסתיר',
                        score: { tandem: 5, twiist: 3, medtronic: 1, omnipod: -1 } 
                    }
                ]
            },
            {
                id: 'cgm',
                text: 'באיזה מד סוכר רציף (סנסור) אתה משתמש כיום או מעדיף?',
                options: [
                    {
                        text: 'Dexcom G6 / G7',
                        score: { tandem: 5, omnipod: 5, ilet: 5, twiist: 5, medtronic: -10 }
                    },
                    {
                        text: 'Guardian 4 / Simplera',
                        score: { medtronic: 10, tandem: -5, omnipod: -5, ilet: -5, twiist: -5 }
                    },
                    {
                        text: 'Freestyle Libre 2 Plus / 3',
                        score: { tandem: 3, omnipod: 3, twiist: 5, ilet: 3, medtronic: -5 }
                    },
                    {
                        text: 'לא משנה לי / מוכן להחליף',
                        score: { medtronic: 2, tandem: 2, omnipod: 2, ilet: 2, twiist: 2 }
                    }
                ]
            },
            {
                id: 'control',
                text: 'האם חשוב לך לשלוט על המשאבה (לתת בולוסים) מהטלפון הנייד?',
                options: [
                    {
                        text: 'כן, זה קריטי לי. הטלפון הוא השלט שלי',
                        score: { tandem: 5, omnipod: 5, twiist: 5, medtronic: -2, ilet: 2 }
                    },
                    {
                        text: 'לא קריטי, מסתדר עם מסך המשאבה',
                        score: { medtronic: 3, tandem: 1, omnipod: 0, ilet: 1, twiist: 1 }
                    }
                ]
            },
            {
                id: 'automation_style',
                text: 'כמה "אגרסיבית" תרצה שהמערכת תהיה בתיקון סוכר גבוה?',
                options: [
                    {
                        text: 'אגרסיבית מאוד. תן לי תיקונים אוטומטיים כל כמה דקות',
                        score: { medtronic: 8, ilet: 6, tandem: 2, omnipod: -3, twiist: 0 }
                    },
                    {
                        text: 'עדינה. תעלה את הרקע (בזאל) אבל אל תתן מנות גדולות לבד',
                        score: { omnipod: 5, tandem: 3, twiist: 3, medtronic: -2, ilet: -2 }
                    }
                ]
            },
            {
                id: 'carbs',
                text: 'איך אתה מסתדר עם ספירת פחמימות?',
                options: [
                    {
                        text: 'אני שונא לספור. מעדיף רק להגיד "ארוחה רגילה/גדולה"',
                        score: { ilet: 15, medtronic: -2, tandem: -2, omnipod: -2, twiist: -2 }
                    },
                    {
                        text: 'אני סופר מדויק ורוצה שליטה על המינון',
                        score: { medtronic: 2, tandem: 5, omnipod: 5, twiist: 5, ilet: -5 }
                    }
                ]
            }
        ];

        // --- STATE ---
        let currentQuestionIndex = 0;
        let scores = { medtronic: 0, tandem: 0, omnipod: 0, ilet: 0, twiist: 0 };
        let history = [];

        // --- FUNCTIONS ---

        function init() {
            lucide.createIcons();
        }

        function startQuiz() {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('question-screen').classList.remove('hidden');
            document.getElementById('question-screen').classList.add('flex');
            renderQuestion();
        }

        function renderQuestion() {
            const question = QUESTIONS[currentQuestionIndex];
            const total = QUESTIONS.length;
            const progress = ((currentQuestionIndex + 1) / total) * 100;

            // Update UI
            document.getElementById('progress-text').innerText = `שאלה ${currentQuestionIndex + 1} מתוך ${total}`;
            document.getElementById('progress-percent').innerText = `${Math.round(progress)}%`;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            
            document.getElementById('question-text').innerText = question.text;

            // Generate Options
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = ''; // Clear previous options

            question.options.forEach((option) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-right p-5 rounded-xl border-2 border-gray-100 hover:border-blue-500 hover:bg-blue-50 transition-all duration-200 group flex items-center justify-between";
                btn.innerHTML = `
                    <span class="text-lg text-gray-700 group-hover:text-blue-700 font-medium">${option.text}</span>
                    <div class="w-6 h-6 rounded-full border-2 border-gray-300 group-hover:border-blue-500 flex items-center justify-center">
                       <div class="w-3 h-3 rounded-full bg-blue-500 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                    </div>
                `;
                btn.onclick = () => handleAnswer(option);
                optionsContainer.appendChild(btn);
            });
        }

        function handleAnswer(option) {
            // Update Scores
            Object.keys(option.score).forEach(pumpKey => {
                scores[pumpKey] += option.score[pumpKey];
            });

            // Track History
            history.push({ 
                question: QUESTIONS[currentQuestionIndex].text, 
                answer: option.text 
            });

            // Next Step
            if (currentQuestionIndex < QUESTIONS.length - 1) {
                currentQuestionIndex++;
                // Add a small delay/animation effect if desired, but here we just render next
                renderQuestion();
            } else {
                showResults();
            }
        }

        function showResults() {
            // Sort Results
            const sortedPumps = Object.entries(scores)
                .sort(([, a], [, b]) => b - a)
                .map(([key]) => PUMPS[key]);

            const topMatch = sortedPumps[0];
            const runnerUp = sortedPumps[1];

            // Render Top Match
            document.getElementById('result-name').innerText = topMatch.name;
            document.getElementById('result-tagline').innerText = topMatch.tagline;
            document.getElementById('result-description').innerText = topMatch.description;

            const prosList = document.getElementById('result-pros');
            prosList.innerHTML = topMatch.pros.map(pro => `
                <li class="flex items-start gap-2 text-gray-600 text-sm">
                    <span class="mt-1.5 w-1.5 h-1.5 bg-green-500 rounded-full flex-shrink-0"></span>
                    ${pro}
                </li>
            `).join('');

            const consList = document.getElementById('result-cons');
            consList.innerHTML = topMatch.cons.map(con => `
                <li class="flex items-start gap-2 text-gray-600 text-sm">
                    <span class="mt-1.5 w-1.5 h-1.5 bg-orange-400 rounded-full flex-shrink-0"></span>
                    ${con}
                </li>
            `).join('');

            // Render Runner Up
            document.getElementById('runner-up-name').innerText = runnerUp.name;
            document.getElementById('runner-up-tagline').innerText = runnerUp.tagline;
            document.getElementById('runner-up-desc').innerText = runnerUp.description;
            document.getElementById('runner-up-pro').innerText = runnerUp.pros[0];

            // Render History
            const historyList = document.getElementById('history-list');
            historyList.innerHTML = history.map(item => `
                <li class="flex justify-between border-b border-gray-200 pb-2 last:border-0">
                    <span class="text-gray-500">${item.question}</span>
                    <span class="text-gray-800 font-medium text-left mr-4">${item.answer}</span>
                </li>
            `).join('');

            // Switch Screens
            document.getElementById('question-screen').classList.add('hidden');
            document.getElementById('question-screen').classList.remove('flex');
            document.getElementById('result-screen').classList.remove('hidden');
            
            // Re-run icons for new content
            lucide.createIcons();
            window.scrollTo(0, 0);
        }

        function resetQuiz() {
            currentQuestionIndex = 0;
            scores = { medtronic: 0, tandem: 0, omnipod: 0, ilet: 0, twiist: 0 };
            history = [];
            
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('welcome-screen').classList.remove('hidden');
        }

        // Initialize icons on load
        window.onload = init;

    </script>
</body>
</html>

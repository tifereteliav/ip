<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PumpSelector - בחירת משאבת אינסולין</title>
    
    <!-- React & ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Heebo', sans-serif;
            background-color: #f0f9ff;
        }
        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- Data Definitions ---

        const pumpsData = [
            {
                id: 'tandem',
                name: 'Tandem t:slim X2',
                type: 'tube',
                minAge: 6,
                hasHebrew: false,
                hasSplitBolus: true,
                hasAppControl: true,
                sensor: 'Dexcom G6/G7',
                features: 'משאבה היברידית קטנה וחכמה עם טכנולוגיית Control-IQ.',
                description: 'משאבת ה-Tandem t:slim X2 היא משאבה היברידית מתקדמת במעגל סגור. היא מתממשקת בצורה חלקה עם סנסור Dexcom, מאפשרת מתן בולוס ישירות מהטלפון הנייד (במכשירים תומכים) ובעלת גודל קומפקטי במיוחד. היא מאפשרת גמישות טיפולית רבה למשתמש.',
                pros: ['שליטה מהנייד (אפליקציה)', 'קטנה ב-38% ממשאבות אחרות', 'גמישות לתיקונים ידניים (Control-IQ)', 'בולוס מפוצל (ייחודי לטנדם)', 'סוללה נטענת'],
                cons: ['דורשת חיבור פיזי למחשב לעדכונים', 'יש צינורית', 'ממשק באנגלית בלבד', 'חובה לנתק בזמן שחייה'],
                matchTags: ['control_app', 'small_size', 'split_bolus', 'rechargeable', 'tech_savvy', 'tube', 'family_share', 'manual_control']
            },
            {
                id: 'medtronic',
                name: 'Medtronic MiniMed 780G',
                type: 'tube',
                minAge: 7,
                hasHebrew: true,
                hasSplitBolus: false, 
                hasAppControl: false, 
                sensor: 'Guardian 4',
                features: 'מערכת אוטומטית חזקה עם ממשק מלא בעברית.',
                description: 'מערכת ה-MiniMed 780G ידועה ביכולתה לתקן רמות סוכר גבוהות באופן אוטומטי כל 5 דקות (SmartGuard), מה שמספק "רשת ביטחון" מצוינת למי שמעדיף לתת למשאבה לנהל את האירוע באופן אוטומטי ולהמעיט בהתערבות.',
                pros: ['ממשק מלא בעברית', 'תיקון אוטומטי אגרסיבי (אוטומציה מלאה)', 'סט עירוי עד 7 ימים', 'סוללת AA (זמינות גבוהה)', 'עמידה למים (נתזים, לא לשחייה)'],
                cons: ['דורשת דקירה אחת לכניסה ל-SmartGuard', 'פחות גמישה לתיקונים ידניים במצב אוטומטי', 'עיצוב מעט גדול יותר', 'חובה לנתק בזמן שחייה'],
                matchTags: ['hebrew', 'carb_struggle', 'waterproof', 'battery_aa', 'tube', 'full_auto']
            },
            {
                id: 'omnipod',
                name: 'Omnipod (DASH / 5)',
                type: 'tubeless',
                minAge: 2,
                hasHebrew: false,
                hasSplitBolus: false,
                hasAppControl: true, 
                sensor: 'Dexcom G6/G7',
                features: 'חופש מצינורות - פוד המוצמד לגוף.',
                description: 'Omnipod מציעה את חווית השימוש היחידה ללא צינורית ("פוד"). הפוד עמיד למים, מוחלף כל 3 ימים ומספק דיסקרטיות מקסימלית. דגם Omnipod 5 מתקשר ישירות עם סנסור Dexcom ומספק איזון היברידי.',
                pros: ['ללא צינורית (חופש תנועה מלא)', 'עמידה מלאה למים (מתאימה לשחייה)', 'החלפה פשוטה', 'דיסקרטית', 'רשימת מזונות מובנית (ב-5)'],
                cons: ['השלט (PDM) חייב להיות קרוב', 'ממשק באנגלית', 'יש להחליף את כל הפוד כל 3 ימים', 'אין בולוס מפוצל'],
                matchTags: ['tubeless', 'waterproof', 'active_lifestyle', 'discrete', 'family_share', 'swimmer']
            }
        ];

        const sensorsData = [
            {
                name: 'Dexcom G6/G7',
                calibration: 'ללא כיול (אלא אם יש אי-התאמה)',
                duration: '10 ימים',
                notes: 'G7 מדויק וקטן יותר. מתחבר ל-Tandem ול-Omnipod 5. מאושר מגיל שנתיים.'
            },
            {
                name: 'Guardian 4',
                calibration: 'ללא דקירות שוטפות (דקירה אחת להפעלת SmartGuard)',
                duration: '7 ימים',
                notes: 'חלק אינטגרלי ממערכת Medtronic 780G. עובד בתיאום מלא לתיקון מינונים.'
            },
            {
                name: 'FreeStyle Libre 2 Plus',
                calibration: 'ללא דקירות (אלא אם יש אי-התאמה)',
                duration: '15 ימים (הארוך ביותר)',
                notes: 'חיישן פלאש המודד כל דקה. נדרשת סריקה לנתונים מלאים אם לא משתמשים באפליקציה רציף.'
            }
        ];

        // --- Icon Component (Safe Wrapper) ---
        const LucideIcon = ({ name, size = 24, className = "" }) => {
            const ref = useRef(null);

            useEffect(() => {
                if (window.lucide && window.lucide.icons && window.lucide.icons[name]) {
                    const iconDef = window.lucide.icons[name];
                    const svg = window.lucide.createElement(iconDef);
                    
                    svg.setAttribute('width', size);
                    svg.setAttribute('height', size);
                    svg.setAttribute('stroke-width', 2);
                    
                    // Combine class names
                    const baseClass = `lucide lucide-${name.toLowerCase()}`;
                    if (className) {
                         svg.setAttribute('class', `${baseClass} ${className}`);
                    } else {
                         svg.setAttribute('class', baseClass);
                    }
                    
                    if (ref.current) {
                        ref.current.innerHTML = '';
                        ref.current.appendChild(svg);
                    }
                }
            }, [name, size, className]);

            return <span ref={ref} className="inline-flex items-center justify-center" style={{ minWidth: size, minHeight: size }} />;
        };

        // --- Icons Collection ---
        const Icons = {
            Activity: (props) => <LucideIcon name="Activity" {...props} />,
            Droplet: (props) => <LucideIcon name="Droplet" {...props} />,
            Smartphone: (props) => <LucideIcon name="Smartphone" {...props} />,
            Languages: (props) => <LucideIcon name="Languages" {...props} />,
            Battery: (props) => <LucideIcon name="Battery" {...props} />,
            Check: (props) => <LucideIcon name="Check" {...props} />,
            AlertCircle: (props) => <LucideIcon name="AlertCircle" {...props} />,
            AlertTriangle: (props) => <LucideIcon name="AlertTriangle" {...props} />,
            Heart: (props) => <LucideIcon name="Heart" {...props} />,
            ChevronRight: (props) => <LucideIcon name="ChevronRight" {...props} />,
            ChevronLeft: (props) => <LucideIcon name="ChevronLeft" {...props} />,
            Stethoscope: (props) => <LucideIcon name="Stethoscope" {...props} />,
            Users: (props) => <LucideIcon name="Users" {...props} />,
            Utensils: (props) => <LucideIcon name="Utensils" {...props} />,
            XCircle: (props) => <LucideIcon name="XCircle" {...props} />,
            Baby: (props) => <LucideIcon name="Baby" {...props} />,
            Waves: (props) => <LucideIcon name="Waves" {...props} />,
            Sliders: (props) => <LucideIcon name="Sliders" {...props} />,
            Info: (props) => <LucideIcon name="Info" {...props} />,
            Mail: (props) => <LucideIcon name="Mail" {...props} />,
            Award: (props) => <LucideIcon name="Award" {...props} />
        };

        // --- Main App Component ---
        function App() {
            const [view, setView] = useState('home'); 
            
            const renderView = () => {
                switch(view) {
                    case 'home': return <Home setView={setView} />;
                    case 'wizard': return <Wizard setView={setView} />;
                    case 'comparison': return <Comparison />;
                    case 'info': return <Info />;
                    case 'about': return <About />;
                    default: return <Home setView={setView} />;
                }
            };

            return (
                <div className="min-h-screen flex flex-col bg-slate-50 text-slate-800">
                    {/* Header */}
                    <header className="bg-teal-600 text-white shadow-lg sticky top-0 z-50">
                        <div className="container mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-2 cursor-pointer" onClick={() => setView('home')}>
                                <Icons.Stethoscope />
                                <h1 className="text-xl font-bold">PumpSelector IL</h1>
                            </div>
                            <nav className="hidden md:flex gap-6 text-sm font-medium">
                                <button onClick={() => setView('home')} className={`hover:text-teal-200 ${view === 'home' ? 'text-teal-100 underline' : ''}`}>ראשי</button>
                                <button onClick={() => setView('wizard')} className={`hover:text-teal-200 ${view === 'wizard' ? 'text-teal-100 underline' : ''}`}>שאלון התאמה</button>
                                <button onClick={() => setView('comparison')} className={`hover:text-teal-200 ${view === 'comparison' ? 'text-teal-100 underline' : ''}`}>השוואת נתונים</button>
                                <button onClick={() => setView('info')} className={`hover:text-teal-200 ${view === 'info' ? 'text-teal-100 underline' : ''}`}>זכאות ומידע</button>
                                <button onClick={() => setView('about')} className={`hover:text-teal-200 ${view === 'about' ? 'text-teal-100 underline' : ''}`}>מי אנחנו</button>
                            </nav>
                            <div className="md:hidden text-xs bg-teal-700 px-2 py-1 rounded">תפריט</div>
                        </div>
                        <div className="md:hidden flex justify-around bg-teal-700 py-2 text-xs text-white">
                             <button onClick={() => setView('wizard')}>שאלון</button>
                             <button onClick={() => setView('comparison')}>השוואה</button>
                             <button onClick={() => setView('info')}>זכאות</button>
                             <button onClick={() => setView('about')}>אודות</button>
                        </div>
                    </header>

                    {/* Content */}
                    <main className="flex-grow container mx-auto px-4 py-8">
                        {renderView()}
                    </main>

                    {/* Footer with Extended Legal Note */}
                    <footer className="bg-slate-800 text-slate-300 py-10 border-t border-slate-700">
                        <div className="container mx-auto px-4 text-center">
                            <p className="mb-4 text-sm">© 2026 PumpSelector IL. פותח ככלי עזר למטופלים וצוות רפואי.</p>
                            
                            <div className="bg-slate-900/50 p-6 rounded-xl max-w-3xl mx-auto border border-slate-700">
                                <h4 className="text-orange-400 font-bold mb-2 flex items-center justify-center gap-2">
                                    <Icons.AlertCircle size={18} /> הבהרה משפטית ורפואית
                                </h4>
                                <p className="text-xs leading-relaxed text-slate-400 text-right">
                                    המידע המופיע באתר זה נועד להרחבת הידע הכללי בלבד ואינו מהווה תחליף לייעוץ רפואי מקצועי, חוות דעת רפואית, אבחנה או המלצה לטיפול. 
                                    <strong> אין באמור באתר זה להחליף ייעוץ רפואי אישי, ובכל מקרה יש להיוועץ עם הצוות הרפואי המטפל בך (רופא אנדוקרינולוג, אחות סוכרת ודיאטנית) לפני קבלת החלטה טיפולית או שינוי בציוד הרפואי.</strong> 
                                    השימוש באתר ובמידע המופיע בו הוא על אחריות המשתמש בלבד. המידע מבוסס על נתונים טכניים שעשויים להשתנות מעת לעת על ידי היצרנים.
                                </p>
                            </div>
                        </div>
                    </footer>
                </div>
            );
        }

        // --- Home View ---
        function Home({ setView }) {
            return (
                <div className="fade-in max-w-4xl mx-auto text-center space-y-12">
                    <section className="space-y-6 py-10">
                        <h2 className="text-4xl md:text-5xl font-bold text-teal-800">בחירת משאבת אינסולין <br/><span className="text-teal-600">הופכת לפשוטה יותר</span></h2>
                        <p className="text-xl text-slate-600 max-w-2xl mx-auto leading-relaxed">
                            כלי עזר חכם למטופלים וצוות רפואי. 
                            השאלון שלנו לוקח בחשבון גיל, שליטה אישית, שחייה, צרכים תזונתיים ועוד כדי למצוא את ההתאמה המושלמת עבורכם.
                        </p>
                        <div className="flex flex-col sm:flex-row justify-center gap-4 mt-8">
                            <button onClick={() => setView('wizard')} className="bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 px-8 rounded-full shadow-lg transition transform hover:-translate-y-1 flex items-center justify-center gap-2">
                                <Icons.Activity />
                                התחל שאלון התאמה מורחב
                            </button>
                            <button onClick={() => setView('comparison')} className="bg-white hover:bg-slate-100 text-teal-700 border-2 border-teal-600 font-bold py-4 px-8 rounded-full shadow transition flex items-center justify-center gap-2">
                                <Icons.Droplet />
                                צפה בטבלאות ההשוואה
                            </button>
                        </div>
                    </section>

                    <section className="grid grid-cols-1 md:grid-cols-3 gap-8 text-right">
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-teal-500">
                            <div className="text-teal-500 mb-4"><Icons.Utensils /></div>
                            <h3 className="text-xl font-bold mb-2">צרכים תזונתיים</h3>
                            <p className="text-slate-600">האם אתם אוכלים ארוחות מורכבות הדורשות בולוס מפוצל? האם אתם מתקשים בספירת פחמימות?</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-teal-500">
                            <div className="text-teal-500 mb-4"><Icons.Sliders /></div>
                            <h3 className="text-xl font-bold mb-2">שליטה ואוטומציה</h3>
                            <p className="text-slate-600">האם אתם מעדיפים שליטה ידנית מלאה או נותנים למשאבה לנהל הכל באוטומט?</p>
                        </div>
                        <div className="bg-white p-6 rounded-xl shadow-md border-t-4 border-teal-500">
                            <div className="text-teal-500 mb-4"><Icons.Languages /></div>
                            <h3 className="text-xl font-bold mb-2">שפה ונוחות</h3>
                            <p className="text-slate-600">סינון קריטי לפי שפת ממשק (עברית/אנגלית) וסוג החיבור לגוף (צינורית או פוד).</p>
                        </div>
                    </section>
                </div>
            );
        }

        // --- Wizard Component ---
        function Wizard({ setView }) {
            const [step, setStep] = useState(0);
            const [answers, setAnswers] = useState({});
            const [result, setResult] = useState(null);

            const questions = [
                {
                    id: 'age_group',
                    text: 'מה גיל המטופל?',
                    icon: <Icons.Baby />,
                    options: [
                        { val: 'under_6', label: 'מתחת לגיל 6' },
                        { val: '6_to_7', label: 'בין 6 ל-7' },
                        { val: 'over_7', label: 'מעל גיל 7' }
                    ]
                },
                {
                    id: 'language',
                    text: 'האם נדרש ממשק מלא בעברית?',
                    icon: <Icons.Languages />,
                    options: [
                        { val: 'must_hebrew', label: 'כן, חובה עברית (המטופל/ת לא מסתדר עם אנגלית)' },
                        { val: 'ok_english', label: 'לא חובה, מסתדרים עם אנגלית בסיסית' }
                    ]
                },
                {
                    id: 'control_pref',
                    text: 'מהי הגישה המועדפת לגבי ניהול הטיפול (אוטומציה מול שליטה)?',
                    icon: <Icons.Sliders />,
                    options: [
                        { val: 'manual_control', label: 'חייב/ת שליטה מלאה - חשוב לי לתת תיקונים ידניים ולהתערב' },
                        { val: 'full_auto', label: 'מעדיף/ה "שגר ושכח" - שהמשאבה תנהל את התיקונים לבד ככל הניתן' }
                    ]
                },
                {
                    id: 'swimming',
                    text: 'האם שחייה היא חלק משמעותי משגרת החיים?',
                    icon: <Icons.Waves />,
                    options: [
                        { val: 'swim_with', label: 'כן, וחשוב לי לשחות עם המשאבה עלי (רצף טיפולי)' },
                        { val: 'swim_disconnect', label: 'כן, אבל אני יכול/ה לנתק אותה לשעה-שעתיים' },
                        { val: 'no_swim', label: 'לא שוחה באופן קבוע' }
                    ]
                },
                {
                    id: 'tubes',
                    text: 'מה ההעדפה לגבי חיבור לגוף (צינורית)?',
                    icon: <Icons.Activity />,
                    options: [
                        { val: 'tubeless', label: 'חובה ללא צינורית ("פוד")' },
                        { val: 'tube', label: 'מעדיף/ה צינורית (חיבור קבוע ויציב)' },
                        { val: 'any', label: 'אין העדפה חזקה' }
                    ]
                },
                {
                    id: 'split_bolus',
                    text: 'האם יש צורך ב"בולוס מפוצל"? (לארוחות עתירות שומן/חלבון כמו פיצה)',
                    icon: <Icons.Utensils />,
                    options: [
                        { val: 'must_split', label: "כן, זה פיצ'ר קריטי עבורנו" },
                        { val: 'not_critical', label: 'לא קריטי / מסתדרים בלי זה' }
                    ]
                },
                {
                    id: 'family_share',
                    text: 'עד כמה חשוב שיתוף המידע עם בני משפחה (Followers)?',
                    icon: <Icons.Users />,
                    options: [
                        { val: 'very_important', label: 'חשוב מאוד (רוצים שכל המשפחה תראה בטלפון)' },
                        { val: 'standard', label: 'סטנדרטי' }
                    ]
                },
                {
                    id: 'tech_control',
                    text: 'האם חשובה שליטה במתן בולוס דרך הטלפון הנייד?',
                    icon: <Icons.Smartphone />,
                    options: [
                        { val: 'yes_app', label: 'כן, רוצים לשלוט מהנייד בלי לגעת במשאבה' },
                        { val: 'no_need', label: 'לא קריטי' }
                    ]
                },
                {
                    id: 'carb_counting',
                    text: 'איך הייתם מגדירים את יכולת ספירת הפחמימות?',
                    icon: <Icons.Activity />,
                    options: [
                        { val: 'struggle', label: 'מתקשים / רוצים מערכת שמתקנת טעויות באופן אגרסיבי' },
                        { val: 'pro', label: 'סופרים במדויק בדרך כלל' }
                    ]
                }
            ];

            const handleAnswer = (val) => {
                const currentQ = questions[step];
                const newAnswers = { ...answers, [currentQ.id]: val };
                setAnswers(newAnswers);
                
                if (step < questions.length - 1) {
                    setStep(step + 1);
                } else {
                    calculateResult(newAnswers);
                }
            };

            const calculateResult = (finalAnswers) => {
                let scores = { tandem: 0, medtronic: 0, omnipod: 0 };
                let mismatches = { tandem: [], medtronic: [], omnipod: [] };
                let matches = { tandem: [], medtronic: [], omnipod: [] };

                // 1. Age Logic
                if (finalAnswers.age_group === 'under_6') {
                    scores.omnipod += 50; 
                    matches.omnipod.push('מאושרת לשימוש מגיל שנתיים (מתאים לגיל הרך)');
                    mismatches.medtronic.push('המשאבה מאושרת לשימוש רק מגיל 7 ומעלה');
                    mismatches.tandem.push('המשאבה מאושרת לשימוש מגיל 6 ומעלה');
                } else if (finalAnswers.age_group === '6_to_7') {
                    scores.tandem += 20;
                    matches.tandem.push('מאושרת לשימוש מגיל 6');
                    scores.omnipod += 20;
                    matches.omnipod.push('מאושרת לשימוש מגיל שנתיים');
                    mismatches.medtronic.push('המשאבה מאושרת לשימוש רק מגיל 7 ומעלה');
                } else {
                    // Over 7
                    scores.medtronic += 10; matches.medtronic.push('מתאימה לגיל המטופל');
                    scores.tandem += 10; matches.tandem.push('מתאימה לגיל המטופל');
                    scores.omnipod += 10; matches.omnipod.push('מתאימה לגיל המטופל');
                }

                // 2. Language
                if (finalAnswers.language === 'must_hebrew') {
                    scores.medtronic += 60;
                    matches.medtronic.push('ממשק מלא בעברית כפי שנדרש');
                    mismatches.tandem.push('ממשק המשאבה הוא באנגלית בלבד');
                    mismatches.omnipod.push('ממשק המשאבה הוא באנגלית בלבד');
                } else {
                    matches.medtronic.push('ממשק בעברית/אנגלית');
                    matches.tandem.push('ממשק באנגלית (תואם לבחירה)');
                    matches.omnipod.push('ממשק באנגלית (תואם לבחירה)');
                }

                // 2.5 Control vs Automation Logic
                if (finalAnswers.control_pref === 'manual_control') {
                    scores.tandem += 40;
                    matches.tandem.push('מערכת Control-IQ מאפשרת גמישות רבה ותיקונים ידניים');
                    mismatches.medtronic.push('המערכת האוטומטית לעיתים מגבילה התערבות ידנית');
                } else if (finalAnswers.control_pref === 'full_auto') {
                    scores.medtronic += 30;
                    matches.medtronic.push('מערכת אוטומטית חזקה (SmartGuard) שלוקחת פיקוד');
                }

                // 2.6 Swimming Logic
                if (finalAnswers.swimming === 'swim_with') {
                    scores.omnipod += 60;
                    matches.omnipod.push('היחידה שמאפשרת שחייה ללא ניתוק (עמידה למים)');
                    mismatches.tandem.push('חובה לנתק את המשאבה בזמן שחייה');
                    mismatches.medtronic.push('חובה לנתק את המשאבה בזמן שחייה');
                } else if (finalAnswers.swimming === 'swim_disconnect') {
                    matches.tandem.push('ניתן לנתק לצורך שחייה לזמן מוגבל');
                    matches.medtronic.push('ניתן לנתק לצורך שחייה לזמן מוגבל');
                }

                // 3. Tubes
                if (finalAnswers.tubes === 'tubeless') {
                    scores.omnipod += 60;
                    matches.omnipod.push('ללא צינורית ("פוד") כפי שביקשתם');
                    mismatches.tandem.push('זוהי משאבה עם צינורית');
                    mismatches.medtronic.push('זוהי משאבה עם צינורית');
                } else if (finalAnswers.tubes === 'tube') {
                    scores.tandem += 20; matches.tandem.push('משאבה עם צינורית (תואם להעדפה)');
                    scores.medtronic += 20; matches.medtronic.push('משאבה עם צינורית (תואם להעדפה)');
                } else {
                    matches.omnipod.push('אופציה ללא צינורית');
                    matches.tandem.push('אופציה עם צינורית');
                    matches.medtronic.push('אופציה עם צינורית');
                }

                // 4. Split Bolus
                if (finalAnswers.split_bolus === 'must_split') {
                    scores.tandem += 50;
                    matches.tandem.push('כוללת אפשרות לבולוס מפוצל (חשוב לארוחות שומניות)');
                    mismatches.medtronic.push('אין בולוס מפוצל (לפי הנתונים)');
                    mismatches.omnipod.push('אין בולוס מפוצל (לפי הנתונים)');
                }

                // 5. Family Sharing
                if (finalAnswers.family_share === 'very_important') {
                    scores.tandem += 10; matches.tandem.push('אפשרויות שיתוף נתונים מתקדמות (Dexcom)');
                    scores.omnipod += 10; matches.omnipod.push('אפשרויות שיתוף נתונים מתקדמות (Dexcom)');
                }

                // 6. App Control
                if (finalAnswers.tech_control === 'yes_app') {
                    scores.tandem += 30;
                    matches.tandem.push('שליטה מלאה במתן בולוס מהאפליקציה');
                    scores.omnipod += 15;
                    matches.omnipod.push('אפשרויות שליטה מהנייד (במודלים תואמים)');
                    mismatches.medtronic.push('שליטה מוגבלת מהנייד (בעיקר צפייה)');
                }

                // 7. Carb Counting
                if (finalAnswers.carb_counting === 'struggle') {
                    scores.medtronic += 40;
                    matches.medtronic.push('מערכת SmartGuard מתקנת אוטומטית טעויות ספירה');
                }

                // Calculate Winner
                const sortedIds = Object.keys(scores).sort((a, b) => scores[b] - scores[a]);
                
                // Prepare result object
                setResult({
                    winnerId: sortedIds[0],
                    runnerUpIds: sortedIds.slice(1),
                    mismatches: mismatches,
                    matches: matches,
                    scores: scores
                });
            };

            const reset = () => {
                setStep(0);
                setAnswers({});
                setResult(null);
            };

            if (result) {
                return <ResultView result={result} pumps={pumpsData} reset={reset} setView={setView} />;
            }

            const currentQ = questions[step];
            const progress = ((step) / questions.length) * 100;

            return (
                <div className="fade-in max-w-2xl mx-auto bg-white p-8 rounded-2xl shadow-xl border-t-8 border-teal-600 text-right">
                    <div className="mb-8">
                        <div className="flex justify-between text-sm text-slate-500 mb-2">
                            <span>שאלה {step + 1} מתוך {questions.length}</span>
                            <span>{Math.round(progress)}%</span>
                        </div>
                        <div className="w-full bg-slate-200 rounded-full h-2.5">
                            <div className="bg-teal-600 h-2.5 rounded-full transition-all duration-300" style={{ width: `${progress}%` }}></div>
                        </div>
                    </div>

                    <div className="flex items-center gap-3 mb-6">
                        <div className="p-3 bg-teal-100 text-teal-700 rounded-full">
                            {currentQ.icon}
                        </div>
                        <h3 className="text-2xl font-bold text-slate-800">{currentQ.text}</h3>
                    </div>

                    <div className="space-y-4">
                        {currentQ.options.map((opt, idx) => (
                            <button 
                                key={idx}
                                onClick={() => handleAnswer(opt.val)}
                                className="w-full text-right p-5 border-2 border-slate-100 rounded-xl hover:border-teal-500 hover:bg-teal-50 transition flex items-center justify-between group"
                            >
                                <span className="font-medium text-lg text-slate-700 group-hover:text-teal-700">{opt.label}</span>
                                <span className="text-slate-300 group-hover:text-teal-500"><Icons.ChevronLeft /></span>
                            </button>
                        ))}
                    </div>
                    
                    {step > 0 && (
                        <button onClick={() => setStep(step - 1)} className="mt-8 text-slate-400 hover:text-slate-600 text-sm flex items-center gap-1">
                            <Icons.ChevronRight size={16}/> חזור לשאלה הקודמת
                        </button>
                    )}
                </div>
            );
        }

        // --- Result Component ---
        function ResultView({ result, pumps, reset, setView }) {
            const winner = pumps.find(p => p.id === result.winnerId);
            const winnerMismatches = result.mismatches[winner.id];
            
            return (
                <div className="fade-in max-w-4xl mx-auto space-y-10 text-right">
                    
                    {/* Winner Section */}
                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-teal-100">
                        <div className="bg-teal-600 p-6 text-white text-center">
                            <h2 className="text-3xl font-bold mb-2">ההמלצה המובילה עבורכם</h2>
                            <p className="opacity-90 text-sm">זכרו: המלצה זו אינה מחליפה ייעוץ רפואי ויש להיוועץ בצוות המטפל.</p>
                        </div>
                        
                        <div className="p-8">
                            <div className="flex flex-col md:flex-row gap-8 items-start">
                                <div className="flex-1">
                                    <h3 className="text-3xl font-bold text-teal-800 mb-4">{winner.name}</h3>
                                    <p className="text-lg text-slate-700 leading-relaxed mb-6">
                                        {winner.description}
                                    </p>
                                    
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-100">
                                            <h4 className="font-bold text-green-800 mb-2 flex items-center gap-2"><Icons.Check size={18}/> יתרונות בולטים</h4>
                                            <ul className="text-sm space-y-1 text-slate-700">
                                                {winner.pros.slice(0, 4).map((pro, i) => <li key={i}>• {pro}</li>)}
                                            </ul>
                                        </div>
                                        
                                        {/* Gaps / Cons Section for Winner */}
                                        <div className="bg-orange-50 p-4 rounded-lg border border-orange-100">
                                            <h4 className="font-bold text-orange-800 mb-2 flex items-center gap-2"><Icons.AlertCircle size={18}/> שימו לב</h4>
                                            {winnerMismatches.length > 0 ? (
                                                <ul className="text-sm space-y-1 text-slate-700">
                                                    {winnerMismatches.map((m, i) => <li key={i}>• {m}</li>)}
                                                </ul>
                                            ) : (
                                                <p className="text-sm text-slate-500">נראה כי אופציה זו עונה על כל הדרישות שהצבתם.</p>
                                            )}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Runners Up Section */}
                    <div>
                        <h3 className="text-2xl font-bold text-slate-700 mb-6 text-center">אפשרויות נוספות שנבדקו</h3>
                        <div className="grid grid-cols-1 gap-6">
                            {result.runnerUpIds.map(id => {
                                const pump = pumps.find(p => p.id === id);
                                const mismatches = result.mismatches[id];
                                const matches = result.matches[id];
                                
                                return (
                                    <div key={id} className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm hover:shadow-md transition">
                                        <h4 className="font-bold text-xl text-slate-800 mb-2">{pump.name}</h4>
                                        <p className="text-sm text-slate-600 mb-4">{pump.features}</p>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            <div className="bg-green-50 p-3 rounded text-sm">
                                                <strong className="block text-green-700 mb-1 flex items-center gap-1">
                                                    <Icons.Check size={14}/> במה זה כן מתאים?
                                                </strong>
                                                <ul className="list-disc list-inside text-slate-700 space-y-1">
                                                    {matches && matches.length > 0 ? (
                                                        matches.map((m, i) => <li key={i}>{m}</li>)
                                                    ) : (
                                                        <li>מאפיינים כלליים: {pump.pros[0]}</li>
                                                    )}
                                                </ul>
                                            </div>

                                            <div className="bg-red-50 p-3 rounded text-sm">
                                                <strong className="block text-red-700 mb-1 flex items-center gap-1">
                                                    <Icons.XCircle size={14}/> למה פחות מתאים לכם?
                                                </strong>
                                                <ul className="list-disc list-inside text-slate-700 space-y-1">
                                                    {mismatches && mismatches.length > 0 ? (
                                                        mismatches.map((m, i) => <li key={i}>{m}</li>)
                                                    ) : (
                                                        <li>פחות התאמה בניקוד הכללי</li>
                                                    )}
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className="flex justify-center gap-4 pt-8 border-t">
                        <button onClick={reset} className="text-teal-600 font-bold hover:underline flex items-center gap-2">
                            <Icons.Activity size={18}/> התחל שאלון מחדש
                        </button>
                        <span className="text-slate-300">|</span>
                        <button onClick={() => setView('comparison')} className="text-teal-600 font-bold hover:underline flex items-center gap-2">
                             <Icons.Droplet size={18}/> עבור לטבלאות השוואה
                        </button>
                    </div>
                </div>
            );
        }

        // --- Comparison Component ---
        function Comparison() {
            const [tab, setTab] = useState('pumps'); 

            return (
                <div className="fade-in max-w-6xl mx-auto text-right">
                    <h2 className="text-3xl font-bold text-center mb-8">השוואה מפורטת</h2>
                    
                    <div className="flex justify-center gap-2 mb-8">
                        <button onClick={() => setTab('pumps')} className={`px-6 py-2 rounded-full font-bold transition ${tab === 'pumps' ? 'bg-teal-600 text-white shadow-md' : 'bg-white text-slate-600 hover:bg-slate-100'}`}>משאבות אינסולין</button>
                        <button onClick={() => setTab('sensors')} className={`px-6 py-2 rounded-full font-bold transition ${tab === 'sensors' ? 'bg-teal-600 text-white shadow-md' : 'bg-white text-slate-600 hover:bg-slate-100'}`}>חיישנים (CGM)</button>
                    </div>

                    <div className="bg-white rounded-2xl shadow-xl overflow-hidden border border-slate-200">
                        <div className="overflow-x-auto">
                            {tab === 'pumps' ? (
                                <table className="w-full min-w-[900px] text-right">
                                    <thead className="bg-slate-100 text-slate-700">
                                        <tr>
                                            <th className="p-4 border-b w-1/5">שם המשאבה</th>
                                            <th className="p-4 border-b w-1/4">מאפיינים וטכנולוגיה</th>
                                            <th className="p-4 border-b w-1/4">יתרונות מרכזיים</th>
                                            <th className="p-4 border-b w-1/4">חסרונות ודרישות</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {pumpsData.map(pump => (
                                            <tr key={pump.id} className="hover:bg-teal-50/30 transition">
                                                <td className="p-4 align-top">
                                                    <div className="font-bold text-lg text-teal-800">{pump.name}</div>
                                                    <div className="text-sm font-medium text-slate-500 mt-1 mb-2">
                                                        {pump.type === 'tubeless' ? 'ללא צינורית' : 'עם צינורית'}
                                                    </div>
                                                    <span className="inline-block px-2 py-1 bg-slate-200 text-xs rounded text-slate-700">גיל {pump.minAge}+</span>
                                                </td>
                                                <td className="p-4 align-top text-sm">
                                                    <p className="mb-2">{pump.features}</p>
                                                    <div className="space-y-1 text-slate-600">
                                                        <div><strong>סנסור:</strong> {pump.sensor}</div>
                                                        <div><strong>שפה:</strong> {pump.hasHebrew ? 'עברית ואנגלית' : 'אנגלית בלבד'}</div>
                                                    </div>
                                                </td>
                                                <td className="p-4 align-top text-sm">
                                                    <ul className="list-disc list-inside space-y-1 text-green-800">
                                                        {pump.pros.map((pro, i) => <li key={i}>{pro}</li>)}
                                                    </ul>
                                                </td>
                                                <td className="p-4 align-top text-sm bg-slate-50">
                                                    <ul className="list-disc list-inside space-y-1 text-red-800">
                                                        {pump.cons.map((con, i) => <li key={i}>{con}</li>)}
                                                    </ul>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            ) : (
                                <table className="w-full min-w-[700px] text-right">
                                    <thead className="bg-slate-100 text-slate-700">
                                        <tr>
                                            <th className="p-4 border-b">שם החיישן</th>
                                            <th className="p-4 border-b">כיול ודקירות</th>
                                            <th className="p-4 border-b">משך שימוש</th>
                                            <th className="p-4 border-b">הערות חשובות</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100">
                                        {sensorsData.map((sensor, idx) => (
                                            <tr key={idx} className="hover:bg-teal-50/30 transition">
                                                <td className="p-4 font-bold text-teal-800">{sensor.name}</td>
                                                <td className="p-4 text-sm">{sensor.calibration}</td>
                                                <td className="p-4 text-sm">{sensor.duration}</td>
                                                <td className="p-4 text-sm text-slate-600">{sensor.notes}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        // --- Info Component ---
        function Info() {
            return (
                <div className="fade-in max-w-4xl mx-auto space-y-8 text-right">
                    <h2 className="text-3xl font-bold text-center text-teal-900">זכאות וסל בריאות</h2>
                    
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div className="bg-white p-6 rounded-xl shadow-md border-r-4 border-blue-500">
                            <h3 className="font-bold text-xl mb-3 flex items-center gap-2">
                                <Icons.AlertCircle className="text-blue-500" />
                                הערה כללית לגבי הסל
                            </h3>
                            <p className="text-slate-600 leading-relaxed">
                                טכנולוגיות אלו (סנסורים ומשאבות היברידיות) ניתנות לרוב במסגרת סל הבריאות לאנשים עם 
                                <strong> סוכרת סוג 1 (סוכרת נעורים)</strong>. הזכאות כפופה לקריטריונים רפואיים נוספים הנקבעים ע"י הקופות.
                            </p>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-md border-r-4 border-teal-500">
                            <h3 className="font-bold text-xl mb-3">Medtronic MiniMed 780G</h3>
                            <ul className="space-y-2 text-slate-600 text-sm">
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-teal-500"/> מאושרת לשימוש לאנשים עם סוכרת סוג 1.</li>
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-teal-500"/> גיל מינימלי: 7 ומעלה.</li>
                            </ul>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-md border-r-4 border-teal-500">
                            <h3 className="font-bold text-xl mb-3">Tandem t:slim X2</h3>
                            <ul className="space-y-2 text-slate-600 text-sm">
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-teal-500"/> זמינה בכל קופות החולים.</li>
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-teal-500"/> מאושרת לשימוש מגיל 6 ומעלה.</li>
                            </ul>
                        </div>

                        <div className="bg-white p-6 rounded-xl shadow-md border-r-4 border-green-500">
                            <h3 className="font-bold text-xl mb-3">Dexcom G6 / G7</h3>
                            <ul className="space-y-2 text-slate-600 text-sm">
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-green-500"/> מאושר לשימוש בילדים מגיל שנתיים ומעלה.</li>
                                <li className="flex items-start gap-2"><Icons.Check size={16} className="mt-1 text-green-500"/> מאושר לשימוש גם במהלך היריון.</li>
                            </ul>
                        </div>
                    </div>
                </div>
            );
        }

        // --- About Us Component ---
        function About() {
            const team = [
                {
                    name: "תפארת אליאב",
                    role: "אחות מומחית בסוכרת",
                    desc: "אחות מומחית בסוכרת בכללית מחוז ירושלים ומקדמת חדשנות."
                },
                {
                    name: "ליאורה ברנסקי",
                    role: "אחות מומחית בסוכרת",
                    desc: "אחות מומחית בסוכרת, כללית מחוז ירושלים."
                },
                {
                    name: "עדי בצלאל",
                    role: "דיאטנית מומחית",
                    desc: "דיאטנית המתמחה בסוכרת סוג 1, מרכזת תחום בכללית מחוז ירושלים."
                }
            ];

            return (
                <div className="fade-in max-w-5xl mx-auto space-y-12 text-right">
                    <section className="text-center space-y-4">
                        <h2 className="text-3xl font-bold text-teal-900">מי אנחנו</h2>
                        <p className="text-lg text-slate-600 max-w-2xl mx-auto">
                            הצוות המקצועי שמאחורי PumpSelector IL מורכב מנשות מקצוע המומחיות בתחום הסוכרת, במטרה להנגיש מידע טכנולוגי עדכני ומותאם אישית למטופלים.
                        </p>
                    </section>

                    {/* Team Image Section */}
                    <div className="bg-white p-4 rounded-2xl shadow-lg border border-slate-100 overflow-hidden">
                        <div className="aspect-video w-full bg-slate-100 rounded-xl flex items-center justify-center relative">
                            <img 
                                src="P.jpeg" 
                                alt="צוות PumpSelector" 
                                className="w-full h-full object-cover rounded-xl"
                                onError={(e) => {
                                    e.target.style.display = 'none';
                                    e.target.parentNode.innerHTML = '<div class="text-slate-400 flex flex-col items-center gap-2"><i class="lucide-users"></i><span>תמונת הצוות - P.jpeg</span></div>';
                                }}
                            />
                        </div>
                    </div>

                    {/* Profiles Grid */}
                    <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
                        {team.map((member, idx) => (
                            <div key={idx} className="bg-white p-6 rounded-2xl shadow-md border-b-4 border-teal-500 hover:shadow-lg transition">
                                <div className="text-teal-600 mb-4 flex justify-center">
                                    <Icons.Award size={40} />
                                </div>
                                <h3 className="text-xl font-bold text-slate-800 mb-1 text-center">{member.name}</h3>
                                <div className="text-teal-600 font-medium text-sm text-center mb-4">{member.role}</div>
                                <p className="text-slate-600 text-sm leading-relaxed">
                                    {member.desc}
                                </p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
